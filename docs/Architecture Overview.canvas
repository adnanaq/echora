{
	"nodes":[
		{"id":"group-services","type":"group","x":-380,"y":320,"width":1040,"height":240,"color":"4","label":"Internal Services"},
		{"id":"group-data","type":"group","x":-160,"y":740,"width":600,"height":200,"color":"2","label":"Data Layer"},
		{"id":"backend001","type":"text","text":"# Backend (BFF)\n\n**Domain**: echora.tech (internal)\n**Tech**: Rust\n- axum\n- async-graphql\n**Role**: External API, routing","x":25,"y":-20,"width":300,"height":150,"color":"1"},
		{"id":"frontend001","type":"text","text":"# Frontend\n\n**Domain**: animora.com (TBD)\n**Tech**: React/Next.js (TBD)","x":25,"y":-220,"width":300,"height":120,"color":"5"},
		{"id":"doc-schema","type":"file","file":"event_schema_specification.md","x":1400,"y":235,"width":300,"height":150},
		{"id":"doc-events","type":"file","file":"event_driven_architecture.md","x":1350,"y":-20,"width":300,"height":150},
		{"id":"ingestion001","type":"text","text":"# Ingestion Pipeline\n\n**Tech**: Python\n- Pydantic\n- crawl4ai\n**Stages**: 1-5 enrichment\n**Role**: Initial enrichment only\n**Output**: AnimeEnrichedEvent","x":1400,"y":530,"width":250,"height":160,"color":"6"},
		{"id":"nats001","type":"text","text":"# NATS JetStream\n\n**From Update Worker / Pipeline:**\n- anime.enriched\n- anime.updated\n- anime.episode.aired\n\n**From PostgreSQL Service (outbox):**\n- anime.created\n- anime.synced\n- anime.deleted\n\n**See**: [[event_driven_architecture]]","x":1100,"y":100,"width":250,"height":270,"color":"3"},
		{"id":"agent001","type":"text","text":"# Agent Service\n\n**Tech**: Python\n- instructor\n- openai\n**Role**: LLM orchestration","x":-360,"y":370,"width":250,"height":140,"color":"4"},
		{"id":"pgdb001","type":"text","text":"# PostgreSQL DB\n\n**Schema**: Anime, Character, Episode\n**Owner**: PostgreSQL Service","x":-140,"y":740,"width":240,"height":160,"color":"2"},
		{"id":"qdrantdb001","type":"text","text":"# Qdrant Vector DB\n\n**Vectors**: text (1024), image (768)\n**Collection**: anime_database","x":160,"y":740,"width":250,"height":160,"color":"2"},
		{"id":"postgres001","type":"text","text":"# PostgreSQL Service\n\n**Tech**: Rust\n- sqlx\n- tonic (gRPC)\n- async-graphql\n**APIs**:\n- gRPC (agent)\n- GraphQL (backend)","x":50,"y":330,"width":250,"height":180,"color":"1"},
		{"id":"doc-postgres","type":"file","file":"postgres_integration_architecture_decision.md","x":750,"y":100,"width":300,"height":105},
		{"id":"doc-update-worker","type":"file","file":"update_worker.md","x":1400,"y":790,"width":300,"height":150},
		{"id":"updateworker001","type":"text","text":"# Update Worker\n\n**Tech**: Python\n- APScheduler\n- nats-py\n- libs/enrichment\n**Jobs**:\n- Sliding window (episodes)\n- Score sync (daily 06:00)","x":1050,"y":700,"width":250,"height":180,"color":"4"},
		{"id":"note-flow","type":"text","text":"# Data Flow\n\n## NL Query (LLM enabled)\nBackend → Agent → (Qdrant + Postgres) → Backend\n\n## Direct Search (LLM disabled/down)\nBackend → Qdrant (direct) + Postgres → Backend\n\n## Initial Ingestion\nPipeline → NATS → Postgres → outbox → NATS → Qdrant\n\n## Ongoing Updates (SAGA)\nUpdate Worker → NATS → Postgres (write + outbox)\n  → NATS (anime.synced) → Qdrant (payload and/or vector)","x":-360,"y":980,"width":500,"height":280,"color":"6"},
		{"id":"note-sync","type":"text","text":"# Model Synchronization\n\n**Problem Solved**: Zero schema duplication!\n\n- Ingestion: No DB models, publishes events\n- PostgreSQL Service: Only service with SQL models\n- Event-driven: NATS decouples services\n\n**See**: [[event_driven_architecture#Event Flow]]","x":175,"y":1020,"width":500,"height":200,"color":"3"},
		{"id":"doc-db-schema","type":"file","file":"Database Schema.md","x":-620,"y":745,"width":300,"height":150},
		{"id":"qdrant001","type":"text","text":"# Qdrant Service\n\n**Tech**: Python\n- qdrant-client\n- transformers\n**Role**: Vector search","x":380,"y":400,"width":250,"height":140,"color":"4"}
	],
	"edges":[
		{"id":"edge001","fromNode":"frontend001","fromSide":"bottom","toNode":"backend001","toSide":"top","label":"GraphQL"},
		{"id":"edge002","fromNode":"backend001","fromSide":"bottom","toNode":"agent001","toSide":"top","color":"4","label":"gRPC (NL queries)"},
		{"id":"edge003","fromNode":"backend001","fromSide":"bottom","toNode":"postgres001","toSide":"top","color":"1","label":"GraphQL (hydration)"},
		{"id":"edge004","fromNode":"agent001","fromSide":"right","toNode":"postgres001","toSide":"left","color":"4","label":"gRPC (graph)"},
		{"id":"edge005","fromNode":"agent001","fromSide":"bottom","toNode":"qdrant001","toSide":"left","color":"4","label":"gRPC (vectors)"},
		{"id":"edge006","fromNode":"postgres001","fromSide":"bottom","toNode":"pgdb001","toSide":"top","label":"SQL writes"},
		{"id":"edge007","fromNode":"qdrant001","fromSide":"bottom","toNode":"qdrantdb001","toSide":"top","label":"vector ops"},
		{"id":"edge008","fromNode":"ingestion001","fromSide":"top","toNode":"nats001","toSide":"bottom","color":"6","label":"publish\nAnimeEnrichedEvent"},
		{"id":"edge009","fromNode":"nats001","fromSide":"left","toNode":"postgres001","toSide":"right","color":"3","label":"consume\nenriched events"},
		{"id":"edge010","fromNode":"postgres001","fromSide":"right","toNode":"nats001","toSide":"left","color":"3","label":"publish via outbox\nanime.created\nanime.synced"},
		{"id":"edge011","fromNode":"nats001","fromSide":"bottom","toNode":"qdrant001","toSide":"right","color":"3","label":"consume\nanime.created\nanime.synced"},
		{"id":"edge012","fromNode":"nats001","fromSide":"top","toNode":"doc-events","toSide":"left","color":"5","label":"docs"},
		{"id":"edge013","fromNode":"nats001","fromSide":"right","toNode":"doc-schema","toSide":"left","color":"5","label":"event schemas"},
		{"id":"edge014","fromNode":"postgres001","fromSide":"right","toNode":"doc-postgres","toSide":"left","color":"5","label":"architecture"},
		{"id":"edge016","fromNode":"backend001","fromSide":"right","toNode":"qdrant001","toSide":"top","color":"2","label":"gRPC direct\n(LLM disabled/down)"},
		{"id":"edge017","fromNode":"updateworker001","fromSide":"top","toNode":"nats001","toSide":"bottom","color":"4","label":"publish\nEpisodeAiredEvent\nAnimeUpdatedEvent"},
		{"id":"edge018","fromNode":"updateworker001","fromSide":"left","toNode":"postgres001","toSide":"bottom","color":"4","label":"query schedule\n(GraphQL)"},
		{"id":"edge019","fromNode":"updateworker001","fromSide":"right","toNode":"doc-update-worker","toSide":"left","color":"5","label":"docs"},
		{"id":"3a7aaa0622257f5a","fromNode":"pgdb001","fromSide":"left","toNode":"doc-db-schema","toSide":"right","color":"4","label":"schema"}
	]
}