# =============================================================================
# ECHORA - Anime Vector Service Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Environment (REQUIRED)
# -----------------------------------------------------------------------------
# Must be set to: development, staging, or production
# No default value for production safety
ENVIRONMENT=development

# -----------------------------------------------------------------------------
# Service Configuration
# -----------------------------------------------------------------------------
VECTOR_SERVICE_HOST=0.0.0.0
VECTOR_SERVICE_PORT=8002
DEBUG=true

# API Metadata
API_TITLE="Anime Vector Service"
API_VERSION=1.0.0
API_DESCRIPTION="Microservice for anime vector database operations"

# Request Handling
REQUEST_TIMEOUT=30
DEFAULT_BATCH_SIZE=100
MAX_BATCH_SIZE=500
MAX_SEARCH_LIMIT=100

# Logging
LOG_LEVEL=INFO
LOG_FORMAT="%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# CORS Configuration (JSON arrays)
ALLOWED_ORIGINS=["*"]
ALLOWED_METHODS=["*"]
ALLOWED_HEADERS=["*"]

# -----------------------------------------------------------------------------
# Qdrant Vector Database
# -----------------------------------------------------------------------------
# Connection
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=
QDRANT_COLLECTION_NAME=anime_database
QDRANT_DISTANCE_METRIC=cosine

# Vector Architecture (JSON objects/arrays)
# Note: Configured programmatically - override only if needed
# VECTOR_NAMES={"text_vector": 1024, "image_vector": 768}
# MULTIVECTOR_VECTORS=["image_vector"]
# VECTOR_PRIORITIES={"high": ["text_vector", "image_vector"], "medium": [], "low": []}

# Quantization (for 40x+ performance with acceptable quality tradeoff)
QDRANT_ENABLE_QUANTIZATION=false
QDRANT_QUANTIZATION_TYPE=scalar
QDRANT_QUANTIZATION_ALWAYS_RAM=
# QUANTIZATION_CONFIG={"high": {"type": "scalar", "scalar_type": "int8", "always_ram": true}, ...}

# HNSW Index Configuration (for large datasets >100k vectors)
QDRANT_HNSW_EF_CONSTRUCT=100
QDRANT_HNSW_M=16
QDRANT_HNSW_MAX_INDEXING_THREADS=0
# HNSW_CONFIG={"high": {"ef_construct": 256, "m": 64, "ef": 128}, ...}

# Memory & Storage
QDRANT_ENABLE_WAL=true
QDRANT_MEMORY_MAPPING_THRESHOLD=1000
MEMORY_MAPPING_THRESHOLD_MB=50

# Payload Indexing (optimizes filtering on anime metadata)
QDRANT_ENABLE_PAYLOAD_INDEXING=true
# Comprehensive payload field index configuration (JSON object)
# See libs/common/src/common/config/qdrant_config.py for full default schema
QDRANT_INDEXED_PAYLOAD_FIELDS={"id":"keyword","title":"keyword","type":"keyword","status":"keyword","episodes":"integer","rating":"keyword","nsfw":"bool","genres":"keyword","tags":"keyword","year":"integer","season":"keyword"}

# -----------------------------------------------------------------------------
# Embedding Models
# -----------------------------------------------------------------------------
# Text Embeddings (BGE-M3 for semantic search)
TEXT_EMBEDDING_PROVIDER=huggingface
TEXT_EMBEDDING_MODEL=BAAI/bge-m3
BGE_MODEL_VERSION=m3
BGE_MODEL_SIZE=base
BGE_MAX_LENGTH=8192

# Image Embeddings (OpenCLIP ViT-L/14 for visual similarity)
IMAGE_EMBEDDING_PROVIDER=openclip
IMAGE_EMBEDDING_MODEL=ViT-L-14/laion2b_s32b_b82k
OPENCLIP_INPUT_RESOLUTION=224
OPENCLIP_TEXT_MAX_LENGTH=77

# Image Processing
IMAGE_BATCH_SIZE=16
MAX_CONCURRENT_IMAGE_DOWNLOADS=10

# Model Management
MODEL_CACHE_DIR=./cache/models
MODEL_WARM_UP=false
EMBED_MAX_CONCURRENCY=2

# -----------------------------------------------------------------------------
# HTTP Cache (for Enrichment Pipeline)
# -----------------------------------------------------------------------------
# Core Settings
CACHE_ENABLED=true
REDIS_URL=redis://localhost:6379/0

# Cache Behavior
FORCE_CACHE=true
ALWAYS_REVALIDATE=false
MAX_CACHE_KEY_LENGTH=200

# Redis Connection Pool (tuned for multi-agent concurrency)
REDIS_MAX_CONNECTIONS=100
REDIS_SOCKET_KEEPALIVE=true
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_SOCKET_TIMEOUT=10
REDIS_RETRY_ON_TIMEOUT=true
REDIS_HEALTH_CHECK_INTERVAL=30

# Service-Specific TTLs (seconds, default: 86400 = 24 hours)
TTL_JIKAN=86400
TTL_ANILIST=86400
TTL_ANIDB=86400
TTL_KITSU=86400
TTL_ANIME_PLANET=86400
TTL_ANISEARCH=86400
TTL_ANIMESCHEDULE=86400

# -----------------------------------------------------------------------------
# Enrichment Pipeline
# -----------------------------------------------------------------------------
# Note: All enrichment env vars use ENRICHMENT_ prefix
# Example: ENRICHMENT_API_TIMEOUT, ENRICHMENT_BATCH_SIZE, etc.
# See libs/enrichment/src/enrichment/programmatic/config.py for full list

# -----------------------------------------------------------------------------
# AniDB API Configuration
# -----------------------------------------------------------------------------
# AniDB requires client registration and strict rate limiting
ANIDB_CLIENT=your_registered_client_name
ANIDB_CLIENTVER=your_client_version
ANIDB_PROTOVER=1

# Rate Limiting (AniDB enforces 2-second minimum between requests)
ANIDB_MIN_REQUEST_INTERVAL=2.0
ANIDB_MAX_REQUEST_INTERVAL=10.0
ANIDB_ERROR_COOLDOWN_BASE=5.0

# Reliability
ANIDB_MAX_RETRIES=3
ANIDB_CIRCUIT_BREAKER_THRESHOLD=5
ANIDB_CIRCUIT_BREAKER_TIMEOUT=300
