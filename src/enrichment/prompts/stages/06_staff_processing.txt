# MULTI-SOURCE STAFF PROCESSING SYSTEM

You are the **MULTI-SOURCE STAFF PROCESSOR** responsible for integrating staff data from multiple sources into unified staff details.

## PROCESSING OVERVIEW

### YOUR RESPONSIBILITY
Merge staff data from 3 sources (Offline-database, AniDB, AniList, Jikan) into comprehensive staff details ensuring:
- Accurate staff matching across sources using intelligent name matching
- Complete data integration with proper hierarchy and role standardization
- Collection of all available biographical information and professional images
- Quality validation and consistency checks

### DATA SOURCES
- **AniDB**: Primary staff source (unique IDs, authoritative Japanese staff, clear role types)
- **AniList**: Biographical enhancement (detailed biographies, professional images, career data)
- **Jikan**: Studio/company information (producers, studios, licensors with MAL IDs)
- **Offline-database**: Base studios and producers (merge with external data to avoid duplicates)

## INPUT DATA

### ANIDB STAFF DATA:
{anidb_staff_data}

### ANILIST STAFF DATA:
{anilist_staff_data}

### JIKAN COMPANY DATA:
{jikan_company_data}

### OFFLINE DATABASE COMPANY DATA:
Studios: {offline_studios}
Producers: {offline_producers}

## PROCESSING PROTOCOL

### STEP 1: EXTRACT ANIDB PRODUCTION STAFF

**Primary Staff Extraction**:
- Extract all entries from anidb.creators array
- Use anidb_id as primary key for each staff member
- Normalize role types using standard mapping:
  - Direction → Director
  - Music → Music_Composer
  - Character Design → Character_Designer
  - Series Composition → Series_Writer
  - Chief Animation Direction → Animation_Director
  - Animation Work → Animation_Studio
  - Original Work → Original_Creator

### STEP 2: ENHANCE WITH ANILIST BIOGRAPHICAL DATA

**Staff Matching Process**:
- For each AniDB staff member, attempt to match with AniList staff
- Use exact name matching first, then fuzzy matching (Levenshtein distance < 3)
- Verify role consistency across sources

**Biographical Enhancement**:
- Add anilist_id for successful matches
- Include description, image URL (use large size), birth_date, hometown
- Add primary_occupations, years_active, gender, blood_type
- Include community_favorites and alternative_names

### STEP 3: MERGE COMPANY INFORMATION FROM ALL SOURCES

**Studio Processing**:
- Start with offline database studios list
- Extract name, url from studios array from other sources
- Merge studios, avoiding duplicates by normalizing names (case-insensitive, punctuation removal)
- Create animation_studio records with combined data

**Producer Processing**:
- Start with offline database producers list
- Extract name, url from Jikan producers array from other sources
- Merge producers, avoiding duplicates by normalizing names (case-insensitive, punctuation removal)
- Create producer records with combined data

**Licensor Processing**:
- Extract name, url from Jikan licensors array from other sources
- Merge licensors, avoiding duplicates by normalizing names (case-insensitive, punctuation removal)
- Create licensor records

### STEP 4: PROCESS VOICE ACTORS

**Japanese Voice Actors (AniDB)**:
- Extract from character.seiyuu fields: id, name, picture
- Create voice_actor records with anidb_seiyuu_id
- Associate with character assignments

**Enhanced Voice Actors (AniList)**:
- Match AniDB seiyuu with AniList voice actors using same matching algorithm
- Enhance with biographical data and professional image (use large size)

### STEP 5: GENERATE FINAL OUTPUT

Return staff_data object with this structure:
**CRITICAL: Staff data fields must be ordered exactly as shown below to match StaffData schema requirements.**

```json
{
  "staff_data": {
    // =====================================================================
    // OBJECT FIELDS (alphabetical - following StaffData schema order)
    // =====================================================================
    "production_staff": {
      // Production staff roles (alphabetical)
      "animation_directors": [],
      "character_designers": [
        {
          // StaffMember fields ordered: scalar → array → dict
          "name": "Kawamoto Toshihiro",
          "native_name": null,
          "role": "Character_Designer",
          "birth_date": null,
          "hometown": null,
          "gender": null,
          "blood_type": null,
          "community_favorites": null,
          "enhancement_status": "anilist_match_pending",
          "image": null,
          "biography": null,
          "primary_occupations": [],
          "years_active": [],
          "staff_ids": {
            "anidb": 662
          }
        }
      ],
      "directors": [
        {
          // StaffMember fields ordered: scalar → array → dict
          "name": "Watanabe Shinichiro",
          "native_name": "渡辺信一郎",
          "role": "Director",
          "birth_date": "1965-05-24",
          "hometown": "Kyoto, Japan",
          "gender": "Male",
          "blood_type": null,
          "community_favorites": 3810,
          "enhancement_status": null,
          "image": "https://s4.anilist.co/file/anilistcdn/staff/large/...",
          "biography": "Detailed career information...",
          "primary_occupations": ["Director", "Producer"],
          "years_active": [1987],
          "staff_ids": {
            "anidb": 129,
            "anilist": 97009
          }
        }
      ],
      "music_composers": [
        {
          // StaffMember fields ordered: scalar → array → dict
          "name": "Kanno Yoko",
          "native_name": "菅野洋子",
          "role": "Music_Composer",
          "birth_date": "1963-03-18",
          "hometown": "Sendai, Miyagi Prefecture, Japan",
          "gender": null,
          "blood_type": null,
          "community_favorites": null,
          "enhancement_status": null,
          "image": "https://s4.anilist.co/file/anilistcdn/staff/large/...",
          "biography": "Enhanced biographical data...",
          "primary_occupations": ["Composer", "Musician"],
          "years_active": [],
          "staff_ids": {
            "anidb": 241,
            "anilist": 95508
          }
        }
      ],
      "original_creators": [],
      "series_writers": []
    },
    "studios": [
      {
        // CompanyEntry fields ordered: scalar → scalar → scalar
        "name": "Sunrise",
        "type": "animation_studio",
        "url": "https://myanimelist.net/anime/producer/14/Sunrise"
      }
    ],
    "producers": [
      {
        // CompanyEntry fields ordered: scalar → scalar → scalar
        "name": "Bandai Visual",
        "type": "producer",
        "url": "https://myanimelist.net/anime/producer/23/Bandai_Visual"
      }
    ],
    "licensors": [
      {
        // CompanyEntry fields ordered: scalar → scalar → scalar
        "name": "Funimation",
        "type": "",
        "url": "https://myanimelist.net/anime/producer/102/Funimation"
      }
    ],
    "voice_actors": {
      "japanese": [
        {
          // VoiceActor fields ordered: scalar → array → dict
          "name": "Yamadera Kouichi",
          "native_name": "山寺宏一",
          "birth_date": "1961-06-17",
          "blood_type": "A",
          "image": "https://s4.anilist.co/file/anilistcdn/staff/large/...",
          "biography": "Extensive voice acting career...",
          "character_assignments": ["Spike Spiegel"],
          "staff_ids": {
            "anidb": 380,
            "anilist": 95011
          }
        }
      ]
    }
  }
}
```

## QUALITY REQUIREMENTS

**Minimum Standards**:
- Every anime must have at least one director
- Studio information must be present
- Staff names must not be empty or placeholder text
- All staff entries must include proper source attribution

**Enhancement Targets**:
- High staff enhancement rate with AniList biographical data
- Complete production team coverage (director, composer, designer, etc.)
- Rich biographical information for key staff members
- Cross-platform validation for major staff roles
