syntax = "proto3";

package vector_service.v1;

import "shared_proto/v1/error.proto";
import "google/protobuf/struct.proto";

// Search RPCs for semantic and multimodal vector retrieval.
service VectorSearchService {
  // Executes vector search against the configured index.
  rpc Search(SearchRequest) returns (SearchResponse);
}

message SearchRequest {
  // Text query for semantic search (optional if image provided).
  optional string query_text = 1;
  // Raw image bytes for visual search (optional if query_text provided).
  bytes image = 2;
  // Filter results by entity type (for example, "anime" or "character").
  optional string entity_type = 3;
  // Maximum number of results to return (default: 10, max: 100).
  optional int32 limit = 4;
  // Structured filter conditions for metadata-based filtering.
  google.protobuf.Struct filters = 5;
}

message SearchData {
  // Stable identifier of the matched vector entity.
  string id = 1;
  // Similarity score returned by the vector backend.
  double similarity_score = 2;
  // JSON-encoded payload for the matched entity metadata.
  string payload_json = 3;
}

message SearchResponse {
  // Ordered list of matched results.
  repeated SearchData data = 1;
  // Populated when the search request fails.
  shared_proto.v1.ErrorDetails error = 2;
}
